#!/usr/bin/env python2
# vim: set noet ts=4 sw=4 fileencoding=utf-8:

import socket
import sys

if __name__=='__main__':
	assert len(sys.argv) == 2

	PORT = 12345
	if sys.argv[1]=='client':
		s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
		s.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
		for i in range(15):
			s.sendto('blabla', ('255.255.255.255', PORT))
	elif sys.argv[1]=='server':
		s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
		s.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
		s.bind(('', PORT))
		print 'listening...'
		while True:
			m = s.recvfrom(1000)
			print m
